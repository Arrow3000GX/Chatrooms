<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Realtime Chatroom (Ably)</title>
  <script src="https://cdn.ably.io/lib/ably.min-1.js"></script>
  <style>
    body { font-family: Arial, sans-serif; background: #f0f4f8; margin: 0; display: flex; align-items: center; justify-content: center; height: 100vh; }
    .chat-container { background: white; border-radius: 10px; box-shadow: 0 0 15px rgba(0,0,0,0.1); width: 90%; max-width: 600px; display: flex; flex-direction: column; height: 80vh; overflow: hidden; }
    .messages { flex: 1; padding: 20px; overflow-y: auto; }
    .message { padding: 10px; margin: 5px 0; border-radius: 8px; max-width: 80%; }
    .you { background: #007bff; color: white; align-self: flex-end; }
    .them { background: #e0e0e0; align-self: flex-start; }
    .form { display: flex; gap: 10px; padding: 10px; border-top: 1px solid #ddd; }
    input { flex: 1; padding: 10px; border-radius: 20px; border: 1px solid #ccc; }
    button { padding: 10px 20px; border-radius: 20px; border: none; background: #007bff; color: white; cursor: pointer; }
  </style>
</head>
<body>
  <div class="chat-container">
    <div class="messages" id="messages"></div>
    <div class="form">
      <input type="text" id="name" placeholder="Your name" />
      <input type="text" id="text" placeholder="Type a message..." />
      <button onclick="send()">Send</button>
    </div>
  </div>

  <script>
    const API_KEY = "kZNFuA.pgX8HQ:3IFD_L8qBtz6_6vwvy34iWw3iXpmaDZaveHIkFRWTAw"; // Replace this
    const channelName = "global-chatroom";

    const ably = new Ably.Realtime(API_KEY);
    const channel = ably.channels.get(channelName);

    const messagesDiv = document.getElementById("messages");

    function appendMessage(text, isYou) {
      const div = document.createElement("div");
      div.className = "message " + (isYou ? "you" : "them");
      div.textContent = text;
      messagesDiv.appendChild(div);
      messagesDiv.scrollTop = messagesDiv.scrollHeight;
    }

    function send() {
      const name = document.getElementById("name").value.trim();
      const text = document.getElementById("text").value.trim();
      if (!name || !text) return;
      channel.publish("chat", { name, text });
      appendMessage(`You: ${text}`, true);
      document.getElementById("text").value = "";
    }

    channel.subscribe("chat", (msg) => {
      const { name, text } = msg.data;
      const myName = document.getElementById("name").value.trim();
      if (name !== myName) {
        appendMessage(`${name}: ${text}`, false);
      }
    });
  </script>
</body>
</html>
